# 空投确认机制使用说明

## 概述

`batch-airdrop.js` 已添加完整的执行前确认机制，确保在执行空投前用户能够查看所有关键信息并明确确认。

## 新增功能

### 📊 详细信息展示

执行前会显示以下信息：

1. **基本信息**
   - 代币地址
   - 总发送数量
   - 接收地址数量

2. **执行计划**
   - 批次大小和总批次数
   - 请求延迟和批次延迟
   - 预估执行时间

3. **空投规则**
   - 最小持有量要求
   - 是否跳过合约地址
   - 当前运行模式（测试/生产）

4. **执行环境**
   - API地址
   - 数据文件路径
   - 当前工作目录

5. **空投示例**
   - 显示前10个空投地址及数量
   - 显示每个地址的原始持有量

6. **重要提示**
   - 操作风险警告
   - 测试模式说明
   - 取消操作提示

### 🔐 确认机制

- **按 Enter 键**: 确认执行
- **Ctrl+C**: 取消操作并退出
- **自动区分**: 测试模式和生产模式显示不同提示

## 使用方法

### 1. 测试确认机制

```bash
# 运行确认机制演示（只显示确认界面，不执行实际空投）
node test-confirmation.js
```

### 2. 执行实际空投

```bash
# 执行完整的空投流程（包含确认步骤）
node batch-airdrop.js
```

## 确认界面示例

```
================================================================================
                          🚀 空投执行确认
================================================================================

📊 基本信息
   代币地址: 0x8a88a1D2bD0a13BA245a4147b7e11Ef1A9d15C8a
   总发送数量: 15,750 tokens
   接收地址数量: 1,250 个地址

📄 执行计划
   批次大小: 10 个/批次
   总批次数: 125 批次
   请求延迟: 1000ms
   批次延迟: 5000ms
   预估执行时间: 约 18 分钟

💰 空投规则
   最小持有量: 1,000 tokens
   跳过合约地址: 是
   测试模式: 否 (将实际发送)

⚙️ 执行环境
   API地址: http://localhost:3000/api/airdrop/dev-send
   当前目录: /path/to/project/airdrop
   数据文件: ./data/native_holders_pages.json

📋 空投示例 (前10个)
    1. 0x1234567890123456789012345678901234567890 -> 25 tokens (持有: 2500.00)
    2. 0x2234567890123456789012345678901234567890 -> 15 tokens (持有: 1500.00)
   ... 还有 1,240 个地址

⚠️  重要提示
   - 🔴 此操作将发送真实的代币，不可撤销！
   - 🔴 请确保代币地址和数量设置正确
   - 🔴 建议先设置 testMode: true 进行测试
   - 📱 执行期间请勿关闭程序
   - 💡 可以使用 Ctrl+C 随时取消操作

================================================================================
⚠️  生产模式 - 按 Enter 键确认执行，Ctrl+C 取消
================================================================================
```

## 配置选项

### 启用/禁用确认机制

确认机制已集成到主流程中，无法单独禁用。这是为了确保操作安全性。

### 测试模式配置

```javascript
// 在 batch-airdrop.js 中修改
CONFIG.execution.testMode = true;  // 测试模式
CONFIG.execution.testMode = false; // 生产模式
```

### 限制处理数量（用于测试）

```javascript
// 限制只处理前N个地址
CONFIG.execution.maxProcessCount = 10; // 只处理10个
CONFIG.execution.maxProcessCount = 0;  // 处理全部
```

## 安全特性

1. **强制确认**: 无论何种模式都需要用户确认
2. **清晰区分**: 测试模式和生产模式有明显不同的提示
3. **详细信息**: 显示所有关键执行参数
4. **随时取消**: 支持 Ctrl+C 取消操作
5. **风险警告**: 明确提示操作的不可逆性

## 故障排除

### 问题：按Enter键没有反应
**解决**：确保终端支持交互输入，避免在后台或非交互环境中运行

### 问题：确认界面显示乱码
**解决**：确保终端支持UTF-8编码和emoji显示

### 问题：想跳过确认直接执行
**回答**：出于安全考虑，确认步骤是强制的，无法跳过

## 最佳实践

1. **先测试**: 首次使用时设置 `testMode: true`
2. **小批量**: 大规模空投前先小批量测试
3. **检查配置**: 仔细核对代币地址和空投规则
4. **环境确认**: 确保在正确的网络环境中执行
5. **备份数据**: 执行前备份重要数据文件

## 更新日志

- **v1.1.0**: 添加完整的执行前确认机制
- **v1.0.0**: 基础批量空投功能