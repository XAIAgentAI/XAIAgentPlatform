# æµ‹è¯•æ–‡æ¡£

æœ¬é¡¹ç›®é‡‡ç”¨ä¸‰å±‚æµ‹è¯•æ¶æ„ï¼Œç¡®ä¿ä»£ç è´¨é‡å’ŒåŠŸèƒ½å®Œæ•´æ€§ã€‚

## ğŸ—ï¸ æµ‹è¯•æ¶æ„

### 1. å•å…ƒæµ‹è¯• (Unit Tests)
**ä½ç½®**: `tests/api/`  
**ç›®çš„**: æµ‹è¯•ä¸šåŠ¡é€»è¾‘ï¼Œéš”ç¦»å¤–éƒ¨ä¾èµ–  
**ç‰¹ç‚¹**:
- ä½¿ç”¨ Mock æ¨¡æ‹Ÿæ‰€æœ‰å¤–éƒ¨ä¾èµ–
- è¿è¡Œé€Ÿåº¦å¿«
- ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘éªŒè¯

### 2. é›†æˆæµ‹è¯• (Integration Tests)  
**ä½ç½®**: `tests/integration/`  
**ç›®çš„**: æµ‹è¯•å®Œæ•´æ¥å£æµç¨‹  
**ç‰¹ç‚¹**:
- ä½¿ç”¨çœŸå®æ•°æ®åº“
- æ¨¡æ‹Ÿå¤–éƒ¨ API è°ƒç”¨
- éªŒè¯æ•°æ®åº“æ“ä½œå’Œä¸šåŠ¡æµç¨‹

### 3. ç«¯åˆ°ç«¯æµ‹è¯• (E2E Tests)
**ä½ç½®**: `scripts/test-*-e2e.ts`  
**ç›®çš„**: æµ‹è¯•å®Œæ•´ç”¨æˆ·åœºæ™¯  
**ç‰¹ç‚¹**:
- çœŸå®ç¯å¢ƒè¿è¡Œ
- å®Œæ•´çš„ç”¨æˆ·æµç¨‹æµ‹è¯•
- å¯ç”¨äºç”Ÿäº§ç¯å¢ƒéªŒè¯

## ğŸš€ è¿è¡Œæµ‹è¯•

### å•ç‹¬è¿è¡Œ
```bash
# å•å…ƒæµ‹è¯•
pnpm run test:unit

# é›†æˆæµ‹è¯•  
pnpm run test:integration

# ç«¯åˆ°ç«¯æµ‹è¯•
pnpm run test:e2e

# æµ‹è¯•è§‚å¯Ÿæ¨¡å¼
pnpm run test:watch
```

### æ‰¹é‡è¿è¡Œ
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm run test:all

# äº¤äº’å¼æµ‹è¯•ç•Œé¢
pnpm run test:ui
```

## ğŸ“ ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ api/                    # å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ deploy-mining.test.ts
â”œâ”€â”€ integration/            # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ deploy-mining.integration.test.ts
â”œâ”€â”€ utils/                  # æµ‹è¯•å·¥å…·
â”‚   â””â”€â”€ test-helpers.ts
â””â”€â”€ README.md

scripts/
â””â”€â”€ test-deploy-mining-e2e.ts  # ç«¯åˆ°ç«¯æµ‹è¯•
```

## ğŸ› ï¸ æµ‹è¯•å·¥å…·

### æµ‹è¯•è¾…åŠ©å‡½æ•°
`tests/utils/test-helpers.ts` æä¾›ï¼š
- JWT Token ç”Ÿæˆ
- æµ‹è¯•ç”¨æˆ·/Agent åˆ›å»º
- æ•°æ®æ¸…ç†åŠŸèƒ½
- è¯·æ±‚æ„å»ºå·¥å…·
- å“åº”éªŒè¯å·¥å…·

### ä½¿ç”¨ç¤ºä¾‹
```typescript
import { setupTestEnvironment, TEST_CONSTANTS } from '../utils/test-helpers'

const { user, agent, token, cleanup } = await setupTestEnvironment()
// ä½¿ç”¨æµ‹è¯•ç¯å¢ƒ
await cleanup() // æ¸…ç†æ•°æ®
```

## ğŸ”§ é…ç½®æ–‡ä»¶

- `vitest.config.ts` - å•å…ƒæµ‹è¯•é…ç½®
- `vitest.integration.config.ts` - é›†æˆæµ‹è¯•é…ç½®

## ğŸ“‹ æµ‹è¯•æ¸…å•

### deploy-mining æ¥å£æµ‹è¯•

#### å•å…ƒæµ‹è¯•è¦†ç›–
- [x] æˆåŠŸåˆ›å»ºéƒ¨ç½²ä»»åŠ¡
- [x] æ—  Token è®¤è¯å¤±è´¥
- [x] æ— æ•ˆ Token è®¤è¯å¤±è´¥  
- [x] Agent ä¸å­˜åœ¨
- [x] æƒé™éªŒè¯ï¼ˆéåˆ›å»ºè€…ï¼‰
- [x] å‚æ•°éªŒè¯å¤±è´¥
- [x] é‡å¤éƒ¨ç½²æ£€æŸ¥
- [x] å¹¶å‘ä»»åŠ¡æ£€æŸ¥

#### é›†æˆæµ‹è¯•è¦†ç›–
- [x] å®Œæ•´éƒ¨ç½²æµç¨‹
- [x] æ•°æ®åº“æ“ä½œéªŒè¯
- [x] çœŸå®ç¯å¢ƒé”™è¯¯å¤„ç†

#### E2Eæµ‹è¯•è¦†ç›–
- [x] ç«¯åˆ°ç«¯éƒ¨ç½²æµç¨‹
- [x] çœŸå®APIè°ƒç”¨
- [x] æ•°æ®æŒä¹…åŒ–éªŒè¯

## ğŸ’¡ æœ€ä½³å®è·µ

### æµ‹è¯•æ•°æ®ç®¡ç†
- ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç¬¦é¿å…æ•°æ®å†²çª
- æµ‹è¯•ååŠæ—¶æ¸…ç†æ•°æ®
- ä½¿ç”¨äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§

### Mock ç­–ç•¥
- å•å…ƒæµ‹è¯•ï¼šMock æ‰€æœ‰å¤–éƒ¨ä¾èµ–
- é›†æˆæµ‹è¯•ï¼šMock å¤–éƒ¨ APIï¼Œä¿ç•™æ•°æ®åº“
- E2Eæµ‹è¯•ï¼šæœ€å°åŒ– Mockï¼Œä½¿ç”¨çœŸå®ç¯å¢ƒ

### æµ‹è¯•å‘½å
- ä½¿ç”¨æè¿°æ€§æµ‹è¯•åç§°
- éµå¾ª "åº”è¯¥[æœŸæœ›è¡Œä¸º]å½“[æ¡ä»¶]æ—¶" æ ¼å¼
- åˆ†ç»„ç›¸å…³æµ‹è¯•ç”¨ä¾‹

## ğŸ› è°ƒè¯•æµ‹è¯•

### æŸ¥çœ‹æµ‹è¯•è¯¦æƒ…
```bash
# è¯¦ç»†è¾“å‡º
pnpm test -- --reporter=verbose

# åªè¿è¡Œç‰¹å®šæµ‹è¯•
pnpm test -- --grep "éƒ¨ç½²ä»»åŠ¡"
```

### å¸¸è§é—®é¢˜
1. **æ•°æ®åº“è¿æ¥é—®é¢˜**: æ£€æŸ¥ `.env` é…ç½®
2. **ç«¯å£å†²çª**: ç¡®ä¿æµ‹è¯•ç«¯å£æœªè¢«å ç”¨
3. **æƒé™é—®é¢˜**: éªŒè¯æµ‹è¯•ç”¨æˆ·æƒé™è®¾ç½®

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Š

è¿è¡Œæµ‹è¯•åä¼šç”Ÿæˆï¼š
- æ§åˆ¶å°è¾“å‡ºæŠ¥å‘Š
- è¦†ç›–ç‡æŠ¥å‘Šï¼ˆå¦‚æœé…ç½®ï¼‰
- æµ‹è¯•ç»“æœæ–‡ä»¶

## ğŸ”„ CI/CD é›†æˆ

æµ‹è¯•å‘½ä»¤é€‚åˆé›†æˆåˆ° CI/CD æµæ°´çº¿ï¼š
```yaml
# GitHub Actions ç¤ºä¾‹
- name: Run Tests
  run: |
    pnpm run test:unit
    pnpm run test:integration
```